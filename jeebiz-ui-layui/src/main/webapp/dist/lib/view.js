layui.define(["laytpl","layer"],function(t){function c(e){return new n(e)}var m=layui.jquery,u=layui.laytpl,h=layui.layer,p=layui.setter,l=(layui.device(),layui.hint()),a="LAY_app_body",n=function(e){this.id=e,this.container=m("#"+(e||a))};c.loading=function(e){e.append(this.elemLoad=m('<i class="layui-anim layui-anim-rotate layui-anim-loop layui-icon layui-icon-loading layadmin-loading"></i>'))},c.removeLoad=function(){this.elemLoad&&this.elemLoad.remove()},c.exit=function(){layui.data(p.tableName,{key:p.storage.tokenName,remove:!0}),location.hash="/user/login"},c.req=function(r){function u(){return p.debug?"<br><cite>URL\uff1a</cite>"+r.url:""}var t,o=r.success,a=(r.error,p.storage),n=p.request,l=p.response;return r.data=r.data||{},r.headers=r.headers||{},n.tokenName&&(t="string"==typeof r.data?JSON.parse(r.data):r.data,r.data[a.tokenName]=a.tokenName in t?r.data[a.tokenName]:layui.data(p.tableName)[a.tokenName]||""),n.headerName&&(r.headers[a.headerName]=a.headerName in r.headers?r.headers[a.headerName]:layui.data(p.tableName)[a.tokenName]||""),console.log(r.headers,"headers2"),n.language&&(r.headers[a.language]=a.language in r.headers?r.headers[a.language]:layui.data(p.tableName)[a.language]||"zh_CN"),delete r.success,delete r.error,m.ajax(m.extend({type:"get",dataType:"json",success:function(e){console.log("res",e);var t=l.statusCode;if(!r.done||0!=e[l.statusName]&&e[l.statusName]!=t.ok)if(e[l.statusName]==t.logout)c.exit();else{var a=e[l.statusName];if(t.status[a]){var n=e[l.msgName]||t.status[a];return console.log(n,a),void h.msg(n,{icon:2,time:3e3})}if(t.authz[a]){var n=e[l.msgName]||t.authz[a];return console.log(n,a),void h.msg(n,{icon:2,time:3e3},function(){c.exit()})}p.debug&&(n=["<cite>Error\uff1a</cite> "+(e[l.msgName]||"\u8fd4\u56de\u72b6\u6001\u7801\u5f02\u5e38"),u()].join(""),c.error(n))}else"function"==typeof r.done&&r.done(e);"function"==typeof o&&o(e)},error:function(t,a,n){p.debug&&console.log(t.responseText);var r=t.responseJSON||{},o=r.code;p.debug&&console.log(r);var s,i=l.statusCode;if(i.status[o]){var d=r[l.msgName]||i.status[o];return console.log(d,o),void h.msg(d,{icon:2,time:3e3})}if(i.authz[o]){d=r[l.msgName]||i.authz[o];return console.log(d,o),void h.msg(d,{icon:2,time:3e3},function(){c.exit()})}p.debug&&(s=["\u8bf7\u6c42\u5f02\u5e38\uff0c\u8bf7\u91cd\u8bd5<br><cite>\u9519\u8bef\u4fe1\u606f\uff1a</cite>",t.status,i.http[t.status],u()].join(""),c.error(s)),"function"==typeof s&&s(e,o)}},r))},c.popup=function(e){var n=e.success,t=e.skin;return delete e.success,delete e.skin,h.open(m.extend({type:1,title:"\u63d0\u793a",content:"",id:"LAY-system-view-popup",skin:"layui-layer-admin"+(t?" "+t:""),shadeClose:!0,closeBtn:!1,success:function(e,t){var a=m('<i class="layui-icon" close>&#x1006;</i>');e.append(a),a.on("click",function(){h.close(t)}),"function"==typeof n&&n.apply(this,arguments)}},e))},c.error=function(e,t){return c.popup(m.extend({content:e,maxWidth:300,offset:"t",anim:6,id:"LAY_adminError"},t))},c.wrap=function(e){e.success,e.error;var t=p.storage,a=p.request,n=p.response;return e.data=e.data||{},e.headers=e.headers||{},a.headerName&&(e.headers[t.headerName]=t.headerName in e.headers?e.headers[t.headerName]:layui.data(p.tableName)[t.tokenName]||""),console.log(e.headers,"headers2"),a.language&&(e.headers[t.language]=t.language in e.headers?e.headers[t.language]:layui.data(p.tableName)[t.language]||"zh_CN"),m.extend({contentType:"application/json",page:{layout:["limit","count","prev","page","next","skip"],groups:1,first:!1,last:!1},height:"full-220",limit:20,method:"POST",request:{pageName:"pageNo",limitName:"limit"},response:{countName:"total",dataName:"rows",statusName:n.statusName,statusCode:n.statusCode.ok,msgName:n.msgName}},e)},n.prototype.render=function(e,n){var r=this;layui.router();return e=p.views+e+p.engine,m("#"+a).children(".layadmin-loading").remove(),c.loading(r.container),m.ajax({url:e,type:"get",dataType:"html",data:{v:layui.cache.version},success:function(e){var t=m(e="<div>"+e+"</div>").find("title"),a={title:t.text()||(e.match(/\<title\>([\s\S]*)\<\/title>/)||[])[1],body:e};t.remove(),r.params=n||{},r.then&&(r.then(a),delete r.then),r.parse(e),c.removeLoad(),r.done&&(r.done(a),delete r.done)},error:function(e){if(c.removeLoad(),r.render.isError)return c.error("\u8bf7\u6c42\u89c6\u56fe\u6587\u4ef6\u5f02\u5e38\uff0c\u72b6\u6001\uff1a"+e.status);404===e.status?r.render("template/tips/404"):r.render("template/tips/error"),r.render.isError=!0}}),r},n.prototype.parse=function(e,t,n){function o(t){var e=u(t.dataElem.html()),a=m.extend({params:i.params},t.res);t.dataElem.after(e.render(a)),"function"==typeof n&&n();try{t.done&&new Function("d",t.done)(a)}catch(e){console.error(t.dataElem[0],"\n\u5b58\u5728\u9519\u8bef\u56de\u8c03\u811a\u672c\n\n",e)}}var a="object"==typeof e,r=a?e:m(e),s=a?e:r.find("*[template]"),i=layui.router();r.find("title").remove(),this.container[t?"after":"html"](r.children()),i.params=this.params||{};for(var d=s.length;0<d;d--)!function(){var t=s.eq(d-1),a=t.attr("lay-done")||t.attr("lay-then"),e=u(t.attr("lay-url")||"").render(i),n=u(t.attr("lay-data")||"").render(i),r=u(t.attr("lay-headers")||"").render(i);try{n=new Function("return "+n+";")()}catch(e){l.error("lay-data: "+e.message),n={}}try{r=new Function("return "+r+";")()}catch(e){l.error("lay-headers: "+e.message),r=r||{}}e?c.req({type:t.attr("lay-type")||"get",url:e,data:n,dataType:"json",headers:r,success:function(e){o({dataElem:t,res:e,done:a})}}):o({dataElem:t,done:a})}();return this},n.prototype.send=function(e,t){t=u(e||this.container.html()).render(t||{});return this.container.html(t),this},n.prototype.refresh=function(e){var t=this,a=t.container.next().attr("lay-templateid");return t.id!=a||t.parse(t.container,"refresh",function(){t.container.siblings('[lay-templateid="'+t.id+'"]:last').remove(),"function"==typeof e&&e()}),t},n.prototype.then=function(e){return this.then=e,this},n.prototype.done=function(e){return this.done=e,this},t("view",c)});