layui.define(["table","form"],function(e){var l=layui.$,a=layui.setter,n=layui.admin,s=layui.table,t=layui.form;s.render({elem:"#LAY-role-list",url:a.prefix+"authz/role/list",contentType:"application/json",page:!0,height:"full-220",limit:30,method:"POST",request:{pageName:"pageNo",limitName:"limit"},response:{countName:"total",dataName:"rows",statusName:"code",statusCode:0,msgName:"message"},cols:[[{type:"checkbox",fixed:"left"},{field:"name",title:"\u89d2\u8272\u540d",minWidth:100},{field:"type",title:"\u7c7b\u578b",width:80,align:"left",templet:"#typeTpl"},{field:"users",width:80,title:"\u7528\u6237\u6570",align:"center"},{field:"time24",width:170,align:"center",title:"\u521b\u5efa\u65f6\u95f4"},{field:"status",title:"\u89d2\u8272\u72b6\u6001",unresize:!0,minWidth:80,align:"center",templet:"#switchTpl"},{title:"\u64cd\u4f5c",minWidth:150,align:"center",fixed:"right",toolbar:"#table-opt-list"}]],skin:"line"}),t.on("submit(LAY-role-search)",function(e){e=e.field;s.reload("LAY-role-list",{where:e,page:{curr:1}})}),t.on("switch(statusKv)",function(e){this.value;var t=l(e.elem).data("id");n.req({url:a.prefix+"authz/role/status",type:"post",data:{id:t,status:e.elem.checked?"1":"0"},success:function(e){"success"==e.status?layer.msg(e.msg||"",{icon:1}):layer.msg(e.msg||"",{icon:2})}})}),s.on("tool(LAY-role-list)",function(e){var i=e.data.id;"detail"===e.event?l.get(a.prefix+"authz/role/ui/detail/"+i,{},function(e){layer.open({area:["700px","600px"],content:e,title:"\u89d2\u8272\u8be6\u60c5",type:1})}):"renew"===e.event?layer.open({type:2,title:"\u7f16\u8f91\u89d2\u8272",content:a.prefix+"authz/role/ui/renew/"+i,area:["700px","600px"],btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(l,e){var t=window["layui-layer-iframe"+l],i="LAY-role-submit",e=e.find("iframe").contents().find("#"+i);t.layui.form.on("submit("+i+")",function(e){var t,i=e.field;for(t in i.perms=i.perms.split(","),i)1<t.split("permsTemp[").length&&delete i[t];n.req({url:a.prefix+"authz/role/renew",type:"post",contentType:"application/json",dataType:"json",data:JSON.stringify(i),success:function(e){"success"==e.status?(layer.msg(e.msg||"",{icon:1}),s.reload("LAY-role-list"),layer.close(l)):layer.msg(e.msg||"",{icon:2})}})}),e.trigger("click")}}):"delete"===e.event&&layer.confirm("\u786e\u5b9a\u5220\u9664\u9009\u4e2d\u7684\u89d2\u8272\u5417\uff1f",function(t){n.req({url:a.prefix+"authz/role/delete/"+i,type:"get",success:function(e){"success"==e.status?(layer.msg(e.msg||"",{icon:1}),s.reload("LAY-role-list")):layer.msg(e.msg||"",{icon:2}),layer.close(t)}})})});var i={add:function(){layer.open({type:2,title:"\u6dfb\u52a0\u89d2\u8272",content:a.prefix+"authz/role/ui/new",area:["600px","500px"],btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(l,e){var t=window["layui-layer-iframe"+l],i="LAY-role-submit",e=e.find("iframe").contents().find("#"+i);t.layui.form.on("submit("+i+")",function(e){var t,i=e.field;for(t in i.perms=i.perms.split(","),i)1<t.split("permsTemp[").length&&delete i[t];n.req({url:a.prefix+"authz/role/new",type:"post",contentType:"application/json",dataType:"json",data:JSON.stringify(i),success:function(e){"success"==e.status?(layer.msg(e.msg||"",{icon:1}),s.reload("LAY-role-list"),layer.close(l)):layer.msg(e.msg||"",{icon:2})}})}),e.trigger("click")}})}};l(".layui-btn.layuiadmin-btn-admin").on("click",function(){var e=l(this).data("type");i[e]&&i[e].call(this)}),e("role",{})});